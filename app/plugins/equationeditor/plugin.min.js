tinymce.create("tinymce.plugins.EquationEditorPlugin", {
	init: function(e, t) {
		var n;
		return n = null, e.addCommand("mceMathquill", function(r) {
			var i;
			return r || (r = ""), i = e.windowManager.open({
				url: "equation_editor.html",
				width: 820,
				height: 400,
				inline: 1,
				popup_css: !1,
				title: "Equation Editor",
				buttons: [{
					text: "Insert",
					subtype: "primary",
					onclick: function() {
						var t, n;
						return n = e.windowManager.getWindows()[0], t = e.windowManager.getParams().latexInput.mathquill("latex"), e.execCommand("mceMathquillInsert", t), n.close()
					}
				}, {
					text: "Cancel",
					onclick: function() {
						return n = null, e.windowManager.getWindows()[0].close()
					}
				}]
			}, {
				plugin_url: t,
				existing_latex: r
			})
		}), e.addCommand("mceMathquillInsert", function(t, r) {
			var i, a;
			if (null == r && (r = !1), t) return a = e.inline === !0 ? "data-current-editor='" + e.id + "'" : "", i = '<span class="rendered-latex" ' + a + ' contenteditable="false">\n  ' + t + "\n</span>&nbsp;", r && (i += "<br>"), n && e.selection.select(n), n = null, e.selection.setContent(i)
		}), e.on("init", function() {
			var t;
			return t = e.inline === !0 ? "[data-current-editor=" + e.id + "]" : ".rendered-latex", $(e.getDoc()).on("click", t, function(t) {
				var r;
				return t.preventDefault(), n = this, r = $(this).find(".selectable").text().replace(/^\$/, "").replace(/\$$/, ""), e.execCommand("mceMathquill", r)
			})
		}), e.addButton("equationeditor", {
			title: "Equation Editor",
			cmd: "mceMathquill",
			text: "f(x)"
		}), e.on("preProcess", function(e) {
			var t;
			return t = e.target.dom.select(".rendered-latex:not(.mathquill-rendered-math)"), $(t).mathquill()
		}), e.on("loadContent", function(e) {
			var t;
			return t = e.target.dom.select("span.rendered-latex:not(.mathquill-rendered-math)"), $(t).mathquill()
		}), e.on("setContent", function(e) {
			var t;
			return t = e.target.dom.select("span.rendered-latex:not(.mathquill-rendered-math)"), $(t).mathquill()
		})
	},
	getInfo: function() {
		return {
			longname: "Equation Editor",
			author: "Foraker, derived from https://github.com/laughinghan/tinymce_mathquill_plugin",
			authorurl: "http://www.foraker.com",
			infourl: "https://github.com/foraker/tinymce_equation_editor",
			version: "1.0"
		}
	}
}), tinymce.PluginManager.add("equationeditor", tinymce.plugins.EquationEditorPlugin);
